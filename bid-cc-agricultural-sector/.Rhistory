diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
if (!file.exists(diroutgcmhis)) {dir.create(diroutgcmhis, recursive=T)}
if (!file.exists(paste(diroutgcmhis, "/by-month", sep=""))) {dir.create(paste(diroutgcmhis, "/by-month", sep=""), recursive=T)}
if (!file.exists(diroutgcmhiscut)) {dir.create(diroutgcmhiscut, recursive=T)}
if (!file.exists(paste(diroutgcmhiscut, "/by-month", sep=""))) {dir.create(paste(diroutgcmhiscut, "/by-month", sep=""), recursive=T)}
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_inmcm4_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[2]
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_inmcm4_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
gcm <- gcmList[14]
var <- varlist[1]
diroutgcmhis <- paste(dirout, "/", basename(gcm), "/1950_2000", sep="")
diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
if (!file.exists(diroutgcmhis)) {dir.create(diroutgcmhis, recursive=T)}
if (!file.exists(paste(diroutgcmhis, "/by-month", sep=""))) {dir.create(paste(diroutgcmhis, "/by-month", sep=""), recursive=T)}
if (!file.exists(diroutgcmhiscut)) {dir.create(diroutgcmhiscut, recursive=T)}
if (!file.exists(paste(diroutgcmhiscut, "/by-month", sep=""))) {dir.create(paste(diroutgcmhiscut, "/by-month", sep=""), recursive=T)}
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_MIROC5_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[2]
l
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_MIROC5_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
gcm <- gcmList[15]
gcm
var <- varlist[1]
diroutgcmhis <- paste(dirout, "/", basename(gcm), "/1950_2000", sep="")
diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
if (!file.exists(diroutgcmhis)) {dir.create(diroutgcmhis, recursive=T)}
if (!file.exists(paste(diroutgcmhis, "/by-month", sep=""))) {dir.create(paste(diroutgcmhis, "/by-month", sep=""), recursive=T)}
if (!file.exists(diroutgcmhiscut)) {dir.create(diroutgcmhiscut, recursive=T)}
if (!file.exists(paste(diroutgcmhiscut, "/by-month", sep=""))) {dir.create(paste(diroutgcmhiscut, "/by-month", sep=""), recursive=T)}
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_HadGEM2-CC_historical_r1i1p1_19491201-19541130 ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_HadGEM2-CC_historical_r1i1p1_19491201-19541130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_HadGEM2-CC_historical_r1i1p1_19541201-19591130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep="")
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[2]
var
diroutgcmhis <- paste(dirout, "/", basename(gcm), "/1950_2000", sep="")
diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_HadGEM2-CC_historical_r1i1p1_19491201-19541130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_HadGEM2-CC_historical_r1i1p1_19541201-19591130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_HadGEM2-CC_historical_r1i1p1_19591201-19641130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1959:1964){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[1]
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_HadGEM2-CC_historical_r1i1p1_19491201-19541130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1954:1954){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[2]
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_HadGEM2-CC_historical_r1i1p1_19541201-19591130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1954:1954){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_HadGEM2-CC_historical_r1i1p1_19491201-19541130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1954:1954){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
gcm <- gcmList[16]
gcm
var <- varlist[1]
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_HadGEM2-ES_historical_r1i1p1_19491201-19591130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
diroutgcmhis <- paste(dirout, "/", basename(gcm), "/1950_2000", sep="")
diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
cat(" Cutting : ", "historical ", basename(gcm), " \n")
if (!file.exists(diroutgcmhis)) {dir.create(diroutgcmhis, recursive=T)}
if (!file.exists(paste(diroutgcmhis, "/by-month", sep=""))) {dir.create(paste(diroutgcmhis, "/by-month", sep=""), recursive=T)}
if (!file.exists(diroutgcmhiscut)) {dir.create(diroutgcmhiscut, recursive=T)}
if (!file.exists(paste(diroutgcmhiscut, "/by-month", sep=""))) {dir.create(paste(diroutgcmhiscut, "/by-month", sep=""), recursive=T)}
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[2]
var
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_HadGEM2-ES_historical_r1i1p1_19491201-19591130.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
gcm <- gcmList[17]
gcm
var <- varlist[1]
diroutgcmhis <- paste(dirout, "/", basename(gcm), "/1950_2000", sep="")
diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
if (!file.exists(diroutgcmhis)) {dir.create(diroutgcmhis, recursive=T)}
if (!file.exists(paste(diroutgcmhis, "/by-month", sep=""))) {dir.create(paste(diroutgcmhis, "/by-month", sep=""), recursive=T)}
if (!file.exists(diroutgcmhiscut)) {dir.create(diroutgcmhiscut, recursive=T)}
if (!file.exists(paste(diroutgcmhiscut, "/by-month", sep=""))) {dir.create(paste(diroutgcmhiscut, "/by-month", sep=""), recursive=T)}
var
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_MPI-ESM-LR_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[2]
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_MPI-ESM-LR_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
gcm <- gcmList[18]
var <- varlist[1]
diroutgcmhis <- paste(dirout, "/", basename(gcm), "/1950_2000", sep="")
diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
cat(" Cutting : ", "historical ", basename(gcm), " \n")
if (!file.exists(diroutgcmhis)) {dir.create(diroutgcmhis, recursive=T)}
if (!file.exists(paste(diroutgcmhis, "/by-month", sep=""))) {dir.create(paste(diroutgcmhis, "/by-month", sep=""), recursive=T)}
if (!file.exists(diroutgcmhiscut)) {dir.create(diroutgcmhiscut, recursive=T)}
if (!file.exists(paste(diroutgcmhiscut, "/by-month", sep=""))) {dir.create(paste(diroutgcmhiscut, "/by-month", sep=""), recursive=T)}
var
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_MPI-ESM-MR_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
var <- varlist[2]
diroutgcmhis
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/rsds_day_MPI-ESM-MR_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
gcm <- gcmList[19]
var <- varlist[1]
diroutgcmhis <- paste(dirout, "/", basename(gcm), "/1950_2000", sep="")
diroutgcmhiscut <- paste(diroutcut, "/", basename(gcm), "/1950_2000", sep="")
cat(" Cutting : ", "historical ", basename(gcm), " \n")
if (!file.exists(diroutgcmhis)) {dir.create(diroutgcmhis, recursive=T)}
if (!file.exists(paste(diroutgcmhis, "/by-month", sep=""))) {dir.create(paste(diroutgcmhis, "/by-month", sep=""), recursive=T)}
if (!file.exists(diroutgcmhiscut)) {dir.create(diroutgcmhiscut, recursive=T)}
if (!file.exists(paste(diroutgcmhiscut, "/by-month", sep=""))) {dir.create(paste(diroutgcmhiscut, "/by-month", sep=""), recursive=T)}
system(paste("cdo sellonlatbox,",bbox@xmin+360-10,",",bbox@xmax+360+10,",",bbox@ymin-10,",",bbox@ymax+10," ", "D:/Documents/Downloads/cmip5/pr_day_MRI-CGCM3_historical_r1i1p1_19500101-19591231.nc ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc",sep=""))
system(paste("cdo splityear ", diroutgcmhis, "/", var, "_1950_2000_day_lat.nc ", diroutgcmhis, "/by-month/", var, "_", sep=""))
for (yr in 1950:1959){
system(paste("cdo splitmon ", diroutgcmhis, "/by-month/", var, "_", yr, ".nc ", diroutgcmhis, "/by-month/", var, "_", yr, "_", sep=""))
file.remove(paste(diroutgcmhis, "/by-month/", var, "_", yr, ".nc", sep=""))
}
library(qmap)
install.packages(qmap)
install.packages("qmap")
install.packages("lubridate")
library(qmap)
library(ncdf)
library(raster)
library(lubridate)
wfdDir = '//dapadfs/data_cluster_4/observed/gridded_products/wfd/'
# gcmDir = "//dapadfs/workspace_cluster_3/bid-cc-agricultural-sector/01-climate-data/gcm_0_5deg_lat/"
gcmDir = "Z:/bid/gcm_0_5deg_lat"
outDir = "Z:/bid/bc_0_5deg_lat"
setwd(outDir)
gcmList <- list.dirs(gcmDir, recursive = FALSE, full.names = FALSE)
gcmList
maskWFDLat <- raster(paste(wfdDir,"raw/mask_wfd_lat.nc",sep=''))
years.hist = 1950:2000  #goes from 1950 to 2001, should use this period eventually (needs to be consistent with GCM.hist)
dates.hist = seq(as.Date('1950-01-01'),as.Date('2000-12-31'),by=1)
months = c(paste(0,1:9,sep=''),10:12)
hist.dat.all = array(NA,dim=c(8199,length(dates.hist)))  #gridcells x dates
maskWFDLat
plot(maskWFDLat)
years.hist = 1950:2000  #goes from 1950 to 2001, should use this period eventually (needs to be consistent with GCM.hist)
dates.hist = seq(as.Date('1950-01-01'),as.Date('2000-12-31'),by=1)
months = c(paste(0,1:9,sep=''),10:12)
WFD = stack(paste(wfdDir,'nc-files/wfd_0_5_deg_lat/Rainf_daily_WFD_GPCC/lat_Rainf_daily_WFD_GPCC_',years.hist[1],months[1],'.nc',sep=''))
WFD
WFD = mask(WFD, maskWFDLat)  #cut to Latin America
xmin(WFD) = xmin(WFD) - 360  #shift to proper longitude
xmax(WFD) = xmax(WFD) - 360
WFD = mask(WFD, maskWFDLat)  #cut to Latin America
WFD
hist.dat = rasterToPoints(WFD)
hist.dat
lenght(hist.dat)
length(hist.dat)
dim(hist.dat)
head(hist.dat)
ncell = rasterToPoints(maskWFDLat)
ncell
dim(ncell)
dim(ncell)[1]
j <- 1
k <- 1
WFD = stack(paste(wfdDir,'nc-files/wfd_0_5_deg_lat/Rainf_daily_WFD_GPCC/lat_Rainf_daily_WFD_GPCC_',years.hist[j],months[k],'.nc',sep=''))
xmin(WFD) = xmin(WFD) - 360  #shift to proper longitude
xmax(WFD) = xmax(WFD) - 360
WFD = mask(WFD, maskWFDLat)  #cut to Latin America
hist.dat = rasterToPoints(WFD)  #extract values (gridcells by days)
if (j==1 & k==1)  {
cells.loc = hist.dat[,1:2]  #extract lat/ long's of gridcells
}
n = dim(hist.dat)[2] - 2  #calculate number of days in month
dates.mo = seq(as.Date(paste(years.hist[j],'-',months[k],'-01',sep='')),as.Date(paste(years.hist[j],'-',months[k],'-',n,sep='')),by=1)
ind.mo = match(dates.mo,dates.hist)  #find indices of this month in big dates vector
hist.dat.all[,ind.mo] = hist.dat[,3:(n+2)]*86400  #convert to mm before putting in big matrix
print(paste(j,k))  #print month & year of loop
var <- "prec"
source('D:/CIAT/_tools/dapa-climate-change/bid-cc-agricultural-sector/01a-biasCorrection_qmap_BID.r')
gcmHistDir <- "Z:/bid/gcm_0_5deg_lat"
gcmList <- list.dirs(gcmHistDir, recursive = FALSE, full.names = FALSE)
gcmList
1:length(gcmList
)
i <- 1
gcm <- paste(as.matrix(gcmList[i]))
gcm
gcm <- gcmList[i]
gcm
gcm <- gcmList[i]
gcm
j %% 1000
2000 %% 1000
ncell
stcell <- ncell / 1000
stcell
stcell <- floor(ncell / 1000)
stcell
start <- (i * 1000) + 1
start
n <- 1
start <- (n * 1000) + 1
start
start <- ((n - 1) * 1000) + 1
start
n <- 2
start <- ((n - 1) * 1000) + 1
start
n <- 9
start <- ((n - 1) * 1000) + 1
start
n <- 1
staCell <- ((n - 1) * 1000) + 1
endCell <- staCell + 999
staCell
endCell
n <- 2
staCell <- ((n - 1) * 1000) + 1
endCell <- staCell + 999
staCell
endCell
n <- 3
staCell <- ((n - 1) * 1000) + 1
endCell <- staCell + 999
staCell
endCell
n <- batchs
n
batchs <- floor(ncell / 1000) + 1
n <- batchs
n
staCell <- ((n - 1) * 1000) + 1
endCell <- staCell + 999
staCell
endCell
batchs <- floor(ncell / 1000) + 1
for (n in 1:batchs){
staCell <- ((n - 1) * 1000) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 999}
print(paste(staCell,endCell))
print("\n")
}
library(snowfall)
install.packages("snowfall")
sfInit(parallel=T,cpus=1) #initiate cluster
library(snowfall)
sfInit(parallel=T,cpus=1) #initiate cluster
stop("error")
source("01a-biasCorrection_qmap_BID.R")
setwd("D:/CIAT/_tools/dapa-climate-change/bid-cc-agricultural-sector")
source("01a-biasCorrection_qmap_BID.R")
wfdDir <- "//dapadfs/data_cluster_4/observed/gridded_products/wfd"
gcmHistDir <- "Z:/bid/gcm_0_5deg_lat"
gcmFutDir <- "//dapadfs/workspace_cluster_3/bid-cc-agricultural-sector/01-climate-data/gcm_0_5deg_lat/"
outDir <- "Z:/bid/bc_0_5deg_lat"
var <- "prec"
sfExport("BC_Qmap")
sfExport("wfdDir")
sfExport("gcmFutDir")
sfExport("gcmHistDir")
sfExport("outDir")
sfExport("var")
gcmList <- list.dirs(gcmHistDir, recursive = FALSE, full.names = FALSE)
gcmList
for (i in 1:length(gcmList)){
# gcm <- paste(as.matrix(gcmList[i]))
gcm <- gcmList[i]
sfExport("gcm")
control <- function(i) { #define a new function
library(qmap)
library(ncdf)
library(raster)
library(lubridate)
cat(" .> ", paste("\t ", i, sep=""), "\t processing!\n")
BC_Qmap(wfdDir, gcmHistDir, gcmFutDir, outDir, var, i)
}
system.time(sfSapply(as.vector(paste(as.matrix(gcmList)[1:length(gcmStats)])), control))
}
sfStop()
library(snowfall)
sfInit(parallel=T,cpus=1) #initiate cluster
stop("error")
source("01a-biasCorrection_qmap_BID.R")
wfdDir <- "//dapadfs/data_cluster_4/observed/gridded_products/wfd"
gcmHistDir <- "Z:/bid/gcm_0_5deg_lat"
gcmFutDir <- "//dapadfs/workspace_cluster_3/bid-cc-agricultural-sector/01-climate-data/gcm_0_5deg_lat/"
outDir <- "Z:/bid/bc_0_5deg_lat"
var <- "prec"
# Export functions
sfExport("BC_Qmap")
#export variables
sfExport("wfdDir")
sfExport("gcmFutDir")
sfExport("gcmHistDir")
sfExport("outDir")
sfExport("var")
gcmList <- list.dirs(gcmHistDir, recursive = FALSE, full.names = FALSE)
for (i in 1:length(gcmList)){
# gcm <- paste(as.matrix(gcmList[i]))
gcm <- gcmList[i]
sfExport("gcm")
control <- function(i) { #define a new function
library(qmap)
library(ncdf)
library(raster)
library(lubridate)
cat(" .> ", paste("\t ", i, sep=""), "\t processing!\n")
BC_Qmap(wfdDir, gcmHistDir, gcmFutDir, outDir, var, i)
}
system.time(sfSapply(as.vector(paste(as.matrix(gcmList)[1:length(gcmList)])), control))
}
sfStop()
batchs <- floor(ncell / 10) + 1
batchs
n <- 1
n <- 1
batchs <- floor(ncell / 1000) + 1
for (n in 1:batchs){
n <- 1
staCell <- ((n - 1) * 1000) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 999}
print(paste(staCell, " ", endCell, sep="\n")
}
for (n in 1:batchs){
n <- 1
staCell <- ((n - 1) * 1000) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 999}
print(paste(staCell, " ", endCell, sep="\n"))
}
print(paste(staCell, " ", endCell, sep="\n"))
batchs <- floor(ncell / 1000) + 1
for (n in 1:batchs){
staCell <- ((n - 1) * 1000) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 999}
print(paste(staCell, " ", endCell, sep="\n"))
}
n <- 1
staCell <- ((n - 1) * 100) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 99}
staCell
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 99}
endCell
n <- 2
staCell <- ((n - 1) * 100) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 99}
endCell
staCell
n <- 820
staCell <- ((n - 1) * 100) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 99}
staCell
batchs <- floor(ncell / 100) + 1
batchs
n <- 82
staCell <- ((n - 1) * 100) + 1
if (n == batchs){endCell <- ncell} else {endCell <- staCell + 99}
staCell
endCell
sfStop()
sfStop()
## Parameters ###
library(snowfall)
sfInit(parallel=T,cpus=1) #initiate cluster
stop("error")
source("01a-biasCorrection_qmap_BID.R")
#Set directories
wfdDir <- "//dapadfs/data_cluster_4/observed/gridded_products/wfd"
gcmHistDir <- "Z:/bid/gcm_0_5deg_lat"
gcmFutDir <- "//dapadfs/workspace_cluster_3/bid-cc-agricultural-sector/01-climate-data/gcm_0_5deg_lat/"
outDir <- "Z:/bid/bc_0_5deg_lat"
var <- "prec"
# Export functions
sfExport("BC_Qmap")
#export variables
sfExport("wfdDir")
sfExport("gcmFutDir")
sfExport("gcmHistDir")
sfExport("outDir")
sfExport("var")
gcmList <- list.dirs(gcmHistDir, recursive = FALSE, full.names = FALSE)
for (i in 1:length(gcmList)){
# gcm <- paste(as.matrix(gcmList[i]))
gcm <- gcmList[i]
sfExport("gcm")
control <- function(i) { #define a new function
library(qmap)
library(ncdf)
library(raster)
library(lubridate)
cat(" .> ", paste("\t ", i, sep=""), "\t processing!\n")
BC_Qmap(wfdDir, gcmHistDir, gcmFutDir, outDir, var, i)
}
system.time(sfSapply(as.vector(paste(as.matrix(gcmList)[1:length(gcmList)])), control))
}
sfStop()
## Parameters ###
library(snowfall)
sfInit(parallel=T,cpus=1) #initiate cluster
stop("error")
source("01a-biasCorrection_qmap_BID.R")
#Set directories
wfdDir <- "//dapadfs/data_cluster_4/observed/gridded_products/wfd"
gcmHistDir <- "Z:/bid/gcm_0_5deg_lat"
gcmFutDir <- "//dapadfs/workspace_cluster_3/bid-cc-agricultural-sector/01-climate-data/gcm_0_5deg_lat/"
outDir <- "Z:/bid/bc_0_5deg_lat"
var <- "prec"
# Export functions
sfExport("BC_Qmap")
#export variables
sfExport("wfdDir")
sfExport("gcmFutDir")
sfExport("gcmHistDir")
sfExport("outDir")
sfExport("var")
gcmList <- list.dirs(gcmHistDir, recursive = FALSE, full.names = FALSE)
for (i in 1:length(gcmList)){
# gcm <- paste(as.matrix(gcmList[i]))
gcm <- gcmList[i]
sfExport("gcm")
control <- function(i) { #define a new function
library(qmap)
library(ncdf)
library(raster)
library(lubridate)
cat(" .> ", paste("\t ", i, sep=""), "\t processing!\n")
BC_Qmap(wfdDir, gcmHistDir, gcmFutDir, outDir, var, i)
}
system.time(sfSapply(as.vector(paste(as.matrix(gcmList)[1:length(gcmList)])), control))
}
dates_nonleap = seq(as.Date('2001-01-01'),as.Date('2001-12-31'),by=1)  #example year
dates_nonleap
read.table("D:/CIAT/Projects/lat-bid-cc-agricultural-sector/02_climate_data/cells_index.txt")
a <- read.table("D:/CIAT/Projects/lat-bid-cc-agricultural-sector/02_climate_data/cells_index.txt")
plot(a)
plot(a[1:1000])
plot(a[1:1000,])
plot(a[1001:2000,])
max(a)
max(a)[1,]
a[1,]
a[[1,]]
a(1)
a[,1]
names(a)
max(a[,2])
min(a[,2])
max(a[,1])
min(a[,1])
