mthList <- c(paste(0,c(1:9),sep=""),paste(c(10:12)))
mthList
mthMat <- as.data.frame(c("Mth", "MthMod", "Ndays"))
mthMat
mthMat <- as.data.frame("Mth", "MthMod", "Ndays")
mthMat <- as.data.frame(cbind(c(paste(0,c(1:9),sep=""),paste(c(10:12))), c(1:12), c(31,28,31,30,31,30,31,31,30,31,30,31)))
names(mthMat) <- c("mth", "mthmod", "ndays")
mthMat
baseline="1950_2000"
stayr <- substr(baseline, 1, 4)
stayr
endyr
endyr <- substr(baseline, 5, 8)
endyr
endyr <- substr(baseline, 5, 9)
endyr
endyr <- substr(baseline, 6, 9)
endyr
gcm="bcc_csm1_1"
var="tasmax"
rcp="rcp_45"
baseline="1950_2000"
dirgcm <- "T:/gcm/cmip5/raw/daily"
if (rcp == "historical"){dirrcp <- paste0(dirgcm, "/", historical)} else {dirrcp <- paste0(dirgcm, "/", rcp)}
dirrcp
ncList <- list.files(path=paste0(dirrcp, "/", gcm, "/r1i1p1"), pattern=paste0(var, "_day*"), full.names=TRUE)
ncList
paste0(dirrcp, "/", gcm, "/r1i1p1")
rcp="historical"
if (rcp == "historical"){dirrcp <- paste0(dirgcm, "/", historical)} else {dirrcp <- paste0(dirgcm, "/", rcp)}
paste0(dirrcp, "/", gcm, "/r1i1p1")
if (rcp == "historical"){dirrcp <- paste0(dirgcm, "/", historical)} else {dirrcp <- paste0(dirgcm, "/", rcp)}
if (rcp == "historical"){dirrcp <- paste0(dirgcm, "/", rcp)} else {dirrcp <- paste0(dirgcm, "/", rcp)}
dirrcp
ncList <- list.files(path=paste0(dirrcp, "/", gcm, "/r1i1p1"), pattern=paste0(var, "_day*"), full.names=TRUE)
ncList
ncList[1]
ncstack = stack(ncList[1])
require(raster)
require(ncdf)
require(rgdal)
ncstack = stack(ncList[1])
var <- "tasmax"
var
ncList
dirtemp <- paste0(dirout, "/", gcm, "/", baseline, "/tmp/", gcm)
dirout <- "D:/workspace/bc"
dirtemp <- paste0(dirout, "/", gcm, "/", baseline, "/tmp/", gcm)
cat(" Extracting : ", " ", basename(gcm), " historical data\n")
if (!file.exists(dirtemp)) {dir.create(dirtemp, recursive=T)}
dirtemp
dirout <- "D:/CIAT/workspace/bc"
if (!file.exists(dirtemp)) {dir.create(dirtemp, recursive=T)}
dirtemp <- paste0(dirout, "/", gcm, "/", baseline, "/tmp/", gcm)
if (!file.exists(dirtemp)) {dir.create(dirtemp, recursive=T)}
dirtemp <- paste0(dirout, "/", gcm)
if (!file.exists(dirtemp)) {dir.create(dirtemp, recursive=T)}
dirtemp <- paste0(dirout, "/", gcm, "tmp")
if (!file.exists(dirtemp)) {dir.create(dirtemp, recursive=T)}
dirtemp
dirtemp <- paste0(dirout, "/", gcm, "/tmp")
if (!file.exists(dirtemp)) {dir.create(dirtemp, recursive=T)}
system(paste0("cdo seldate,", stayr, "-01-01,", endyr,"-12-31 ", ncList[1], " ", dirtemp, "/dayobs_", var, "_", stayr, "_", endyr, ".nc", sep=""))
paste0("cdo seldate,", stayr, "-01-01,", endyr,"-12-31 ", ncList[1], " ", dirtemp, "/dayobs_", var, "_", stayr, "_", endyr, ".nc")
system(paste0("cdo seldate,", stayr, "-01-01,", endyr,"-12-31 ", ncList[1], " ", dirtemp, "/dayobs_", var, "_", stayr, "_", endyr, ".nc"))
ncvarsel <- paste0(dirtemp, "/dayobs_", var, "_", stayr, "_", endyr, ".nc")
ncvarsel
ncstack = stack(ncvarsel)
plot(ncstack)
ncstack = stack(rotate(ncvarsel))
ncstack = rotate(stack(ncvarsel))
ncstack <- stack(ncvarsel)
ncstack
if (lon < 0){lon <- lon + 360}
lon=-73.5
lat=3.4
if (lon < 0){lon <- lon + 360}
lon
extobs <- extract(ncstack, c(lon, lat))
system(paste0("cdo -outputtab,date,year,month,day,value -remapnn,lon=", lon, "_lat=", lat, " ", ncvar[1], " > ", dirtemp, "/daygcm_tasmax_timeseries.txt"))
ncvar <- list.files(path=paste0(dirrcp, "/", gcm, "/r1i1p1"), pattern=paste0(var, "_day*"), full.names=TRUE)
ncvar
system(paste0("cdo -outputtab,date,year,month,day,value -remapnn,lon=", lon, "_lat=", lat, " ", ncvar[1], " > ", dirtemp, "/daygcm_tasmax_timeseries.txt"))
